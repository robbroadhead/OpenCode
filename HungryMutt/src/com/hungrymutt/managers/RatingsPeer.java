package com.hungrymutt.managers;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.Date;

import org.apache.torque.Torque;

/** 
 * The skeleton for this class was autogenerated by Torque on:
 *
 * [Fri Dec 10 23:11:00 CST 2004]
 *
 *  You should add additional methods to this class to meet the
 *  application requirements.  This class will only be generated as
 *  long as it does not already exist in the output directory.
 */
public class RatingsPeer 
    extends com.hungrymutt.managers.BaseRatingsPeer
{
	static public double averageRating(int recipeid) {
		PreparedStatement stmt;
		Date today = new Date();
		ResultSet rs;
		double result = 0;

		try {
			Connection con = Torque.getConnection();
			stmt = con.prepareStatement("Select avg(rating) from Ratings where recipeid=" + recipeid);
			rs = stmt.executeQuery();
			rs.next();
			result = rs.getDouble(1);
			rs.close();
			stmt.close();
			Torque.closeConnection(con);
		} catch (Exception e) {
			e.printStackTrace();
		}

		return result;
	}
	
	static public boolean hasEnteredRating(String theaddress,int recipeid) {
		PreparedStatement stmt;
		Date today = new Date();
		ResultSet rs;
		boolean result = false;

		try {
			Connection con = Torque.getConnection();
			stmt = con.prepareStatement("Select count(*) from Ratings where recipeid=" + recipeid + " and ipaddress='" + theaddress + "'");
			rs = stmt.executeQuery();
			rs.next();
			result = (rs.getInt(1) > 0);
			rs.close();
			stmt.close();
			Torque.closeConnection(con);
		} catch (Exception e) {
			e.printStackTrace();
		}

		return result;		
	}
}
